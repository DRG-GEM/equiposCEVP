<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Verbal - CEVP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&family=Changa+One&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8fafc;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* --- ESTILOS CART√ìN --- */
        .bingo-card-container {
            background-color: #fff;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border: 1px solid #e2e8f0;
        }
        .bingo-header { font-family: 'Changa One', sans-serif; letter-spacing: 0.15em; }
        
        .bingo-cell {
            position: relative;
            background-color: #f1f5f9;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.1s;
        }
        .bingo-cell:active { transform: scale(0.96); }

        /* Ficha semitransparente */
        .bingo-chip {
            position: absolute;
            top: 50%; left: 50%;
            width: 80%; height: 80%;
            background-color: rgba(239, 68, 68, 0.5);
            border-radius: 50%;
            border: 4px solid rgba(220, 38, 38, 0.8);
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .bingo-cell.marked .bingo-chip { transform: translate(-50%, -50%) scale(1); }

        /* --- TARJETITAS (TAGS) --- */
        .tag-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 700;
            font-size: 1.1rem;
            margin: 0.25rem;
            box-shadow: 0 2px 0 rgba(0,0,0,0.05);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        /* Colores espec√≠ficos para cada categor√≠a gramatical */
        .tag-person { background-color: #e0e7ff; color: #3730a3; border: 1px solid #c7d2fe; } /* Indigo */
        .tag-number { background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; } /* Green */
        .tag-tense  { background-color: #ffedd5; color: #9a3412; border: 1px solid #fed7aa; } /* Orange */
        .tag-mood   { background-color: #f3f4f6; color: #374151; border: 1px solid #e5e7eb; } /* Gray */

        .screen-enter { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .animate-pop { animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { 0% { opacity:0; transform: scale(0.5); } 100% { opacity:1; transform: scale(1); } }

        /* Estilo para el modal */
        #verify-modal {
            backdrop-filter: blur(4px);
            background-color: rgba(0,0,0,0.4);
        }
    </style>
</head>
<body class="min-h-screen text-slate-800 flex flex-col">

    <!-- HEADER -->
    <header class="bg-slate-900 text-white p-3 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="location.reload()">
                <!-- LOGO COOPERATIVA -->
                <div class="bg-white p-1 rounded-lg h-12 w-12 flex items-center justify-center overflow-hidden">
                    <img src="https://web.virgendelpasico.net/wp-content/uploads/2024/01/cropped-ncoop-scaled-1-300x253.jpg" alt="Logo Cooperativa" class="h-full w-auto object-contain">
                </div>
                <div>
                    <h1 class="text-xl font-bold leading-none tracking-tight">Bingo Verbal</h1>
                    <span class="text-xs text-slate-400 font-bold tracking-wide">CEVP</span>
                </div>
            </div>
            <button onclick="location.reload()" class="bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-lg text-sm transition border border-slate-700 flex items-center gap-2">
                <i class="ph ph-arrow-counter-clockwise"></i> <span class="hidden md:inline">Reiniciar</span>
            </button>
        </div>
    </header>

    <main class="flex-grow container mx-auto p-4 max-w-6xl">

        <!-- CONFIGURACI√ìN -->
        <section id="config-screen" class="screen-enter max-w-2xl mx-auto mt-8">
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200">
                <div class="bg-indigo-600 p-6 text-white text-center">
                    <h2 class="text-3xl font-bold mb-1">Bingo de Tiempos Verbales</h2>
                    <p class="text-indigo-200 text-sm">Configuraci√≥n de la partida</p>
                </div>

                <div class="p-8">
                    <!-- Modo de Juego -->
                    <div class="mb-8">
                        <label class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-3 block">1. Din√°mica de Juego</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- MODO DETECTIVE -->
                            <label class="relative group cursor-pointer">
                                <input type="radio" name="gameMode" value="analyst" class="peer sr-only" checked>
                                <div class="p-4 rounded-xl border-2 border-slate-200 peer-checked:border-indigo-500 peer-checked:bg-indigo-50 transition hover:border-indigo-200 h-full">
                                    <div class="flex items-center gap-3 mb-2">
                                        <div class="bg-indigo-100 text-indigo-600 p-2 rounded-full"><i class="ph ph-magnifying-glass text-xl"></i></div>
                                        <span class="font-bold text-slate-800">Detective de Verbos</span>
                                    </div>
                                    <p class="text-xs text-slate-600 leading-relaxed">
                                        T√∫ das las <span class="font-bold text-indigo-600">pistas</span> (persona, tiempo...).<br>
                                        Ellos encuentran al sospechoso ("Yo com√≠").
                                    </p>
                                </div>
                            </label>
                            <!-- MODO MAESTRO -->
                            <label class="relative group cursor-pointer">
                                <input type="radio" name="gameMode" value="identifier" class="peer sr-only">
                                <div class="p-4 rounded-xl border-2 border-slate-200 peer-checked:border-indigo-500 peer-checked:bg-indigo-50 transition hover:border-indigo-200 h-full">
                                    <div class="flex items-center gap-3 mb-2">
                                        <div class="bg-indigo-100 text-indigo-600 p-2 rounded-full"><i class="ph ph-graduation-cap text-xl"></i></div>
                                        <span class="font-bold text-slate-800">Maestro Gramatical</span>
                                    </div>
                                    <p class="text-xs text-slate-600 leading-relaxed">
                                        T√∫ muestras el <span class="font-bold text-indigo-600">verbo conjugado</span>.<br>
                                        Ellos demuestran saber qu√© tiempo es.
                                    </p>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- SELECTOR DE DIFICULTAD -->
                    <div class="mb-8">
                        <label class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-3 block">2. Nivel de Dificultad</label>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                            
                            <!-- NIVEL 1 -->
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="difficulty" value="1" class="peer sr-only" checked>
                                <div class="p-3 rounded-xl border-2 border-slate-200 bg-white peer-checked:border-emerald-500 peer-checked:bg-emerald-50 hover:bg-slate-50 transition h-full flex flex-col">
                                    <div class="font-bold text-slate-700 peer-checked:text-emerald-700 mb-1 flex items-center gap-2">
                                        <span class="w-3 h-3 rounded-full bg-emerald-500"></span> Nivel 1
                                    </div>
                                    <div class="text-xs text-slate-500 mt-1 flex-grow">
                                        <p class="font-semibold mb-1 text-slate-600">Iniciado</p>
                                        <ul class="list-disc list-inside opacity-80">
                                            <li>Solo Indicativo</li>
                                            <li>Solo Tiempos Simples</li>
                                        </ul>
                                    </div>
                                </div>
                            </label>

                            <!-- NIVEL 2 -->
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="difficulty" value="2" class="peer sr-only">
                                <div class="p-3 rounded-xl border-2 border-slate-200 bg-white peer-checked:border-amber-500 peer-checked:bg-amber-50 hover:bg-slate-50 transition h-full flex flex-col">
                                    <div class="font-bold text-slate-700 peer-checked:text-amber-700 mb-1 flex items-center gap-2">
                                        <span class="w-3 h-3 rounded-full bg-amber-500"></span> Nivel 2
                                    </div>
                                    <div class="text-xs text-slate-500 mt-1 flex-grow">
                                        <p class="font-semibold mb-1 text-slate-600">Experto</p>
                                        <ul class="list-disc list-inside opacity-80">
                                            <li>Todo el Indicativo</li>
                                            <li>Simples y Compuestos</li>
                                        </ul>
                                    </div>
                                </div>
                            </label>

                            <!-- NIVEL 3 -->
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="difficulty" value="3" class="peer sr-only">
                                <div class="p-3 rounded-xl border-2 border-slate-200 bg-white peer-checked:border-rose-500 peer-checked:bg-rose-50 hover:bg-slate-50 transition h-full flex flex-col">
                                    <div class="font-bold text-slate-700 peer-checked:text-rose-700 mb-1 flex items-center gap-2">
                                        <span class="w-3 h-3 rounded-full bg-rose-500"></span> Nivel 3
                                    </div>
                                    <div class="text-xs text-slate-500 mt-1 flex-grow">
                                        <p class="font-semibold mb-1 text-slate-600">Maestro</p>
                                        <ul class="list-disc list-inside opacity-80">
                                            <li>Indicativo Completo</li>
                                            <li>Subjuntivo Completo</li>
                                        </ul>
                                    </div>
                                </div>
                            </label>

                        </div>
                        <p id="error-msg" class="text-rose-500 text-sm mt-3 hidden font-bold flex items-center gap-2">
                            <i class="ph ph-warning-circle text-lg"></i> Error de carga.
                        </p>
                    </div>

                    <!-- Botones de Acci√≥n -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-slate-100">
                        <button onclick="startGame('teacher')" class="flex items-center justify-center gap-3 p-4 bg-slate-900 text-white rounded-xl shadow hover:bg-slate-800 transition transform active:scale-95">
                            <i class="ph ph-projector-screen-chart text-2xl"></i>
                            <div class="text-left leading-tight">
                                <span class="block font-bold">Soy el Profesor</span>
                                <span class="text-xs text-slate-400">Pantalla de proyecci√≥n</span>
                            </div>
                        </button>
                        <button onclick="startGame('student')" class="flex items-center justify-center gap-3 p-4 bg-white border-2 border-slate-200 text-slate-700 rounded-xl hover:border-indigo-500 hover:text-indigo-600 transition transform active:scale-95">
                            <i class="ph ph-student text-2xl"></i>
                            <div class="text-left leading-tight">
                                <span class="block font-bold">Soy Alumno</span>
                                <span class="text-xs text-slate-400">Generar mi cart√≥n</span>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- PANTALLA PROFESOR -->
        <section id="teacher-screen" class="hidden screen-enter h-full flex flex-col">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 h-full">
                
                <!-- ZONA PRINCIPAL (PROYECCI√ìN) -->
                <div class="lg:col-span-8 flex flex-col gap-4">
                    <!-- Caja de la Bola -->
                    <div class="bg-white rounded-2xl shadow-xl border border-slate-200 flex flex-col relative overflow-hidden min-h-[400px]">
                        <!-- Barra superior -->
                        <div class="bg-indigo-600 h-3 w-full"></div>
                        <div class="absolute top-5 right-5">
                            <span class="bg-slate-100 text-slate-500 px-3 py-1 rounded-full text-sm font-bold border border-slate-200">
                                Restantes: <span id="remaining-count" class="text-indigo-600">--</span>
                            </span>
                        </div>

                        <!-- CONTENIDO CENTRAL (BOLA) -->
                        <div id="ball-display" class="flex-grow flex flex-col items-center justify-center p-8 text-center">
                            <div class="text-slate-400 flex flex-col items-center animate-pulse">
                                <i class="ph ph-play-circle text-6xl mb-4"></i>
                                <span class="text-xl font-medium">Pulsa "Sacar Bola" para comenzar</span>
                            </div>
                        </div>

                        <!-- ZONA INFERIOR (CONTROLES) -->
                        <div class="bg-slate-50 p-6 border-t border-slate-200 flex items-center justify-between gap-4">
                             <!-- Spoiler Toggle -->
                            <div class="flex items-center gap-2">
                                <button onclick="toggleAnswer()" class="text-slate-400 hover:text-indigo-600 p-2 rounded-lg hover:bg-white transition" title="Ver respuesta">
                                    <i id="eye-icon" class="ph ph-eye-slash text-2xl"></i>
                                </button>
                                <div id="spoiler-answer" class="text-lg font-bold text-slate-800 opacity-0 transition-opacity select-none bg-white px-4 py-1 rounded shadow-sm border border-slate-200">
                                    ...
                                </div>
                            </div>

                            <button onclick="drawBall()" class="bg-indigo-600 hover:bg-indigo-700 text-white text-xl font-bold py-3 px-8 rounded-xl shadow-lg shadow-indigo-200 transform active:translate-y-1 transition flex items-center gap-3">
                                <i class="ph ph-shuffle"></i>
                                <span>SACAR BOLA</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ZONA LATERAL (HISTORIAL) -->
                <div class="lg:col-span-4 bg-white rounded-2xl shadow-lg border border-slate-200 flex flex-col overflow-hidden max-h-[600px]">
                    <div class="bg-slate-100 p-4 font-bold text-slate-700 flex items-center justify-between border-b border-slate-200">
                        <span class="flex items-center gap-2"><i class="ph ph-clock-counter-clockwise"></i> √öltimos Verbos</span>
                        <div class="flex gap-2">
                            <button onclick="openVerifyModal()" class="bg-white hover:bg-emerald-50 text-emerald-600 border border-emerald-200 px-2 py-1 rounded text-xs font-bold transition flex items-center gap-1">
                                <i class="ph ph-check-circle"></i> Comprobar
                            </button>
                        </div>
                    </div>
                    <ul id="history-list" class="flex-1 overflow-y-auto p-2 space-y-2 bg-slate-50">
                        <!-- Items -->
                    </ul>
                </div>
            </div>
        </section>

        <!-- PANTALLA ALUMNO -->
        <section id="student-screen" class="hidden screen-enter max-w-lg mx-auto pb-12">
            
            <div class="flex items-center justify-between mb-6 px-2">
                <div>
                    <h2 class="font-bold text-slate-800 text-lg">Tu Cart√≥n</h2>
                    <p class="text-xs text-slate-500">Escucha al profesor y marca.</p>
                </div>
                <button onclick="checkBingo()" class="bg-emerald-500 hover:bg-emerald-600 text-white px-5 py-2 rounded-full font-bold shadow-lg shadow-emerald-200 transform hover:-translate-y-1 transition flex items-center gap-2">
                    <i class="ph ph-hand-waving"></i> ¬°BINGO!
                </button>
            </div>

            <!-- CART√ìN -->
            <div class="bingo-card-container rounded-xl overflow-hidden transform transition-transform hover:scale-[1.01] duration-300">
                <div class="bg-indigo-600 p-4 text-center border-b-4 border-indigo-800 relative">
                    <div class="absolute top-1/2 left-4 -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow-inner opacity-50"></div>
                    <div class="absolute top-1/2 right-4 -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow-inner opacity-50"></div>
                    <h1 class="bingo-header text-5xl text-white drop-shadow-md">BINGO</h1>
                </div>

                <div id="bingo-grid" class="grid grid-cols-4 gap-1 p-2 bg-slate-200">
                    <!-- JS generar√° las celdas aqu√≠ -->
                </div>
                
                <div class="bg-slate-100 p-2 flex justify-between items-center text-[10px] text-slate-400 font-mono uppercase border-t border-slate-200">
                    <span>ID: <span id="card-id" class="font-bold text-indigo-600 text-lg">--</span></span>
                    <span onclick="generateStudentCard()" class="cursor-pointer hover:text-indigo-500 underline decoration-dotted">Cambiar Cart√≥n</span>
                </div>
            </div>
            
            <div class="mt-4 text-center text-xs text-slate-400 px-4">
                Si cantas Bingo, dicta tu <strong>n√∫mero de ID</strong> al profesor para comprobarlo.
            </div>

        </section>

    </main>

    <!-- MODAL DE VERIFICACI√ìN (PROFESOR) -->
    <div id="verify-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden transform transition-all scale-95 opacity-0" id="verify-modal-content">
            <div class="bg-slate-800 p-4 text-white flex justify-between items-center">
                <h3 class="font-bold flex items-center gap-2"><i class="ph ph-shield-check"></i> Comprobar Cart√≥n</h3>
                <button onclick="closeVerifyModal()" class="hover:bg-slate-700 p-1 rounded"><i class="ph ph-x text-lg"></i></button>
            </div>
            <div class="p-6">
                <p class="text-sm text-slate-600 mb-4">Introduce el ID del cart√≥n del alumno para verificar si su Bingo es correcto.</p>
                <div class="flex gap-2 mb-4">
                    <input type="number" id="verify-input" placeholder="Ej: 4582" class="flex-grow border-2 border-slate-200 rounded-lg px-4 py-2 text-lg font-bold text-center tracking-widest focus:border-indigo-500 focus:outline-none">
                    <button onclick="verifyCard()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-indigo-700">Verificar</button>
                </div>
                <!-- Resultado -->
                <div id="verify-result" class="hidden rounded-lg p-4 border text-center">
                    <!-- Contenido din√°mico -->
                </div>
            </div>
        </div>
    </div>

    <!-- CONFETI -->
    <canvas id="confetti-canvas" class="fixed top-0 left-0 w-full h-full pointer-events-none z-50"></canvas>

    <!-- LOGICA -->
    <script>
        // ============================================
        // 0. GENERADOR DE N√öMEROS ALEATORIOS CON SEMILLA
        // ============================================
        // Clase para generar secuencias deterministas basadas en el ID del cart√≥n
        class SeededRandom {
            constructor(seed) {
                this.seed = seed;
            }
            // Algoritmo Linear Congruential Generator simple
            next() {
                this.seed = (this.seed * 9301 + 49297) % 233280;
                return this.seed / 233280;
            }
        }

        // ============================================
        // 1. DATOS
        // ============================================
        const rawData = [
            // --- INDICATIVO SIMPLE (30+) ---
            ["Comer", "Yo como", "1¬™", "Singular", "Presente", "Indicativo", "simple"],
            ["Vivir", "T√∫ vives", "2¬™", "Singular", "Presente", "Indicativo", "simple"],
            ["Cantar", "√âl canta", "3¬™", "Singular", "Presente", "Indicativo", "simple"],
            ["Beber", "Nosotros bebemos", "1¬™", "Plural", "Presente", "Indicativo", "simple"],
            ["Escribir", "Vosotros escrib√≠s", "2¬™", "Plural", "Presente", "Indicativo", "simple"],
            ["Correr", "Ellos corren", "3¬™", "Plural", "Presente", "Indicativo", "simple"],
            
            ["Saltar", "Yo salt√©", "1¬™", "Singular", "Pret. Perf. Simple", "Indicativo", "simple"],
            ["Comer", "T√∫ comiste", "2¬™", "Singular", "Pret. Perf. Simple", "Indicativo", "simple"],
            ["Salir", "√âl sali√≥", "3¬™", "Singular", "Pret. Perf. Simple", "Indicativo", "simple"],
            ["Ver", "Nosotros vimos", "1¬™", "Plural", "Pret. Perf. Simple", "Indicativo", "simple"],
            ["Dar", "Vosotros disteis", "2¬™", "Plural", "Pret. Perf. Simple", "Indicativo", "simple"],
            ["Ir", "Ellos fueron", "3¬™", "Plural", "Pret. Perf. Simple", "Indicativo", "simple"],

            ["Estar", "Yo estaba", "1¬™", "Singular", "Pret. Imperfecto", "Indicativo", "simple"],
            ["Tener", "T√∫ ten√≠as", "2¬™", "Singular", "Pret. Imperfecto", "Indicativo", "simple"],
            ["Hacer", "Ella hac√≠a", "3¬™", "Singular", "Pret. Imperfecto", "Indicativo", "simple"],
            ["Jugar", "Nosotros jug√°bamos", "1¬™", "Plural", "Pret. Imperfecto", "Indicativo", "simple"],
            ["Leer", "Vosotros le√≠ais", "2¬™", "Plural", "Pret. Imperfecto", "Indicativo", "simple"],
            ["Decir", "Ellos dec√≠an", "3¬™", "Plural", "Pret. Imperfecto", "Indicativo", "simple"],

            ["Amar", "Yo amar√©", "1¬™", "Singular", "Futuro Simple", "Indicativo", "simple"],
            ["Saber", "T√∫ sabr√°s", "2¬™", "Singular", "Futuro Simple", "Indicativo", "simple"],
            ["Poner", "√âl pondr√°", "3¬™", "Singular", "Futuro Simple", "Indicativo", "simple"],
            ["Venir", "Nosotros vendremos", "1¬™", "Plural", "Futuro Simple", "Indicativo", "simple"],
            ["Tener", "Vosotros tendr√©is", "2¬™", "Plural", "Futuro Simple", "Indicativo", "simple"],
            ["Hacer", "Ellos har√°n", "3¬™", "Plural", "Futuro Simple", "Indicativo", "simple"],

            ["Ser", "Yo ser√≠a", "1¬™", "Singular", "Condicional Simple", "Indicativo", "simple"],
            ["Ir", "T√∫ ir√≠as", "2¬™", "Singular", "Condicional Simple", "Indicativo", "simple"],
            ["Ver", "√âl ver√≠a", "3¬™", "Singular", "Condicional Simple", "Indicativo", "simple"],
            ["Dar", "Nosotros dar√≠amos", "1¬™", "Plural", "Condicional Simple", "Indicativo", "simple"],
            ["Saber", "Vosotros sabr√≠ais", "2¬™", "Plural", "Condicional Simple", "Indicativo", "simple"],
            ["Poder", "Ellos podr√≠an", "3¬™", "Plural", "Condicional Simple", "Indicativo", "simple"],

            // --- INDICATIVO COMPUESTO (20+) ---
            ["Hablar", "Yo he hablado", "1¬™", "Singular", "Pret. Perf. Compuesto", "Indicativo", "compound"],
            ["Estudiar", "T√∫ has estudiado", "2¬™", "Singular", "Pret. Perf. Compuesto", "Indicativo", "compound"],
            ["Abrir", "√âl ha abierto", "3¬™", "Singular", "Pret. Perf. Compuesto", "Indicativo", "compound"],
            ["Romper", "Nosotros hemos roto", "1¬™", "Plural", "Pret. Perf. Compuesto", "Indicativo", "compound"],
            ["Ver", "Ellos han visto", "3¬™", "Plural", "Pret. Perf. Compuesto", "Indicativo", "compound"],
            
            ["Vivir", "Yo hab√≠a vivido", "1¬™", "Singular", "Pret. Pluscuamperf.", "Indicativo", "compound"],
            ["Llegar", "T√∫ hab√≠as llegado", "2¬™", "Singular", "Pret. Pluscuamperf.", "Indicativo", "compound"],
            ["Salir", "√âl hab√≠a salido", "3¬™", "Singular", "Pret. Pluscuamperf.", "Indicativo", "compound"],
            ["Acabar", "Nosotros hab√≠amos acabado", "1¬™", "Plural", "Pret. Pluscuamperf.", "Indicativo", "compound"],
            ["Caer", "Ellos hab√≠an ca√≠do", "3¬™", "Plural", "Pret. Pluscuamperf.", "Indicativo", "compound"],
            
            ["Ganar", "Yo habr√© ganado", "1¬™", "Singular", "Futuro Compuesto", "Indicativo", "compound"],
            ["Perder", "T√∫ habr√°s perdido", "2¬™", "Singular", "Futuro Compuesto", "Indicativo", "compound"],
            ["Elegir", "√âl habr√° elegido", "3¬™", "Singular", "Futuro Compuesto", "Indicativo", "compound"],
            ["Andar", "Nosotros habremos andado", "1¬™", "Plural", "Futuro Compuesto", "Indicativo", "compound"],
            ["Dormir", "Ellos habr√°n dormido", "3¬™", "Plural", "Futuro Compuesto", "Indicativo", "compound"],
            
            ["Estar", "Yo habr√≠a estado", "1¬™", "Singular", "Condic. Compuesto", "Indicativo", "compound"],
            ["Ser", "T√∫ habr√≠as sido", "2¬™", "Singular", "Condic. Compuesto", "Indicativo", "compound"],
            ["Ir", "√âl habr√≠a ido", "3¬™", "Singular", "Condic. Compuesto", "Indicativo", "compound"],
            ["Tener", "Nosotros habr√≠amos tenido", "1¬™", "Plural", "Condic. Compuesto", "Indicativo", "compound"],
            ["Hacer", "Ellos habr√≠an hecho", "3¬™", "Plural", "Condic. Compuesto", "Indicativo", "compound"],

            // --- SUBJUNTIVO SIMPLE (18+) ---
            ["Cantar", "Yo cante", "1¬™", "Singular", "Presente", "Subjuntivo", "simple"],
            ["Beber", "T√∫ bebas", "2¬™", "Singular", "Presente", "Subjuntivo", "simple"],
            ["Vivir", "√âl viva", "3¬™", "Singular", "Presente", "Subjuntivo", "simple"],
            ["Tener", "Nosotros tengamos", "1¬™", "Plural", "Presente", "Subjuntivo", "simple"],
            ["Salir", "Vosotros salg√°is", "2¬™", "Plural", "Presente", "Subjuntivo", "simple"],
            ["Poner", "Ellos pongan", "3¬™", "Plural", "Presente", "Subjuntivo", "simple"],

            ["Hablar", "Yo hablara", "1¬™", "Singular", "Pret. Imperfecto", "Subjuntivo", "simple"],
            ["Comer", "T√∫ comieras", "2¬™", "Singular", "Pret. Imperfecto", "Subjuntivo", "simple"],
            ["Saber", "√âl supiera", "3¬™", "Singular", "Pret. Imperfecto", "Subjuntivo", "simple"],
            ["Ir", "Nosotros fu√©ramos", "1¬™", "Plural", "Pret. Imperfecto", "Subjuntivo", "simple"],
            ["Hacer", "Vosotros hicierais", "2¬™", "Plural", "Pret. Imperfecto", "Subjuntivo", "simple"],
            ["Decir", "Ellos dijeran", "3¬™", "Plural", "Pret. Imperfecto", "Subjuntivo", "simple"],

            ["Estar", "Yo estuviese", "1¬™", "Singular", "Pret. Imperfecto (B)", "Subjuntivo", "simple"],
            ["Ser", "T√∫ fueses", "2¬™", "Singular", "Pret. Imperfecto (B)", "Subjuntivo", "simple"],
            ["Dar", "√âl diese", "3¬™", "Singular", "Pret. Imperfecto (B)", "Subjuntivo", "simple"],
            ["Ver", "Nosotros vi√©semos", "1¬™", "Plural", "Pret. Imperfecto (B)", "Subjuntivo", "simple"],
            ["O√≠r", "Vosotros oyeseis", "2¬™", "Plural", "Pret. Imperfecto (B)", "Subjuntivo", "simple"],
            ["Traer", "Ellos trajesen", "3¬™", "Plural", "Pret. Imperfecto (B)", "Subjuntivo", "simple"],

            // --- SUBJUNTIVO COMPUESTO (10+) ---
            ["Acabar", "Yo haya acabado", "1¬™", "Singular", "Pret. Perf. Compuesto", "Subjuntivo", "compound"],
            ["Empezar", "T√∫ hayas empezado", "2¬™", "Singular", "Pret. Perf. Compuesto", "Subjuntivo", "compound"],
            ["Volver", "√âl haya vuelto", "3¬™", "Singular", "Pret. Perf. Compuesto", "Subjuntivo", "compound"],
            ["Ver", "Nosotros hayamos visto", "1¬™", "Plural", "Pret. Perf. Compuesto", "Subjuntivo", "compound"],
            ["Abrir", "Ellos hayan abierto", "3¬™", "Plural", "Pret. Perf. Compuesto", "Subjuntivo", "compound"],

            ["Llamar", "Yo hubiera llamado", "1¬™", "Singular", "Pret. Pluscuamperf.", "Subjuntivo", "compound"],
            ["Sentir", "T√∫ hubieras sentido", "2¬™", "Singular", "Pret. Pluscuamperf.", "Subjuntivo", "compound"],
            ["Pedir", "√âl hubiera pedido", "3¬™", "Singular", "Pret. Pluscuamperf.", "Subjuntivo", "compound"],
            ["Dormir", "Nosotros hubi√©ramos dormido", "1¬™", "Plural", "Pret. Pluscuamperf.", "Subjuntivo", "compound"],
            ["Morir", "Ellos hubieran muerto", "3¬™", "Plural", "Pret. Pluscuamperf.", "Subjuntivo", "compound"]
        ];

        // Mapear a Objetos
        const verbDatabase = rawData.map((d, i) => ({
            id: i + 1,
            infinitive: d[0],
            conjugation: d[1],
            person: d[2],
            number: d[3],
            tense: d[4],
            mood: d[5],
            type: d[6],
            fullDesc: `${d[2]} ${d[3]} ${d[4]} (${d[5]})`
        }));

        // ============================================
        // 2. ESTADO
        // ============================================
        let gameState = {
            role: null,
            mode: 'analyst',
            filtered: [],
            available: [],
            drawnIds: new Set(), // NUEVO: Para comprobar bingos
            currentVerb: null
        };

        // ============================================
        // 3. FUNCIONES DE JUEGO
        // ============================================

        function startGame(role) {
            const diffLevel = document.querySelector('input[name="difficulty"]:checked').value;
            let filtered = [];

            filtered = verbDatabase.filter(v => {
                if (diffLevel === "1") return v.mood === 'Indicativo' && v.type === 'simple';
                else if (diffLevel === "2") return v.mood === 'Indicativo';
                else return true; 
            });

            if (filtered.length < 12) {
                document.getElementById('error-msg').innerText = "Error: No hay suficientes verbos.";
                document.getElementById('error-msg').classList.remove('hidden');
                return;
            }

            gameState.filtered = filtered;
            gameState.available = [...filtered];
            gameState.drawnIds = new Set(); // Resetear
            gameState.role = role;
            gameState.mode = document.querySelector('input[name="gameMode"]:checked').value;

            document.getElementById('config-screen').classList.add('hidden');
            
            if (role === 'teacher') {
                document.getElementById('teacher-screen').classList.remove('hidden');
                updateRemaining();
            } else {
                document.getElementById('student-screen').classList.remove('hidden');
                generateStudentCard();
            }
        }

        // --- PROFESOR ---
        function updateRemaining() {
            document.getElementById('remaining-count').innerText = gameState.available.length;
        }

        function toggleAnswer() {
            const el = document.getElementById('spoiler-answer');
            const icon = document.getElementById('eye-icon');
            if (el.classList.contains('opacity-0')) {
                el.classList.remove('opacity-0');
                icon.className = "ph ph-eye text-2xl text-indigo-600";
            } else {
                el.classList.add('opacity-0');
                icon.className = "ph ph-eye-slash text-2xl";
            }
        }

        function drawBall() {
            if (gameState.available.length === 0) {
                alert("¬°Fin de las bolas!");
                return;
            }

            document.getElementById('spoiler-answer').classList.add('opacity-0');
            document.getElementById('eye-icon').className = "ph ph-eye-slash text-2xl";

            const idx = Math.floor(Math.random() * gameState.available.length);
            const verb = gameState.available[idx];
            
            gameState.available.splice(idx, 1);
            gameState.drawnIds.add(verb.id); // Guardar ID
            gameState.currentVerb = verb;
            
            updateRemaining();

            const display = document.getElementById('ball-display');
            const answerEl = document.getElementById('spoiler-answer');
            display.innerHTML = ''; 

            if (gameState.mode === 'analyst') {
                display.innerHTML = `
                    <div class="animate-pop flex flex-col items-center gap-4">
                        <div class="text-xs text-slate-400 font-mono uppercase tracking-widest mb-2">Descripci√≥n Gramatical</div>
                        <div class="flex flex-wrap justify-center gap-2 max-w-2xl">
                            <span class="tag-badge tag-person">${verb.person} Persona</span>
                            <span class="tag-badge tag-number">${verb.number}</span>
                        </div>
                        <div class="flex flex-wrap justify-center gap-2 max-w-3xl my-2">
                            <span class="tag-badge tag-tense text-2xl md:text-4xl py-3 px-6 shadow-md border-b-4 border-orange-200">${verb.tense}</span>
                        </div>
                        <div class="flex flex-wrap justify-center gap-2">
                            <span class="tag-badge tag-mood">${verb.mood}</span>
                        </div>
                    </div>
                `;
                answerEl.innerText = verb.conjugation; 
            } else {
                display.innerHTML = `
                    <div class="animate-pop flex flex-col items-center">
                        <div class="text-xs text-slate-400 font-mono uppercase tracking-widest mb-4">Verbo Conjugado</div>
                        <h2 class="text-5xl md:text-7xl font-bold text-indigo-700 drop-shadow-sm mb-4">${verb.conjugation}</h2>
                        <div class="bg-indigo-50 text-indigo-400 px-4 py-1 rounded-full text-sm font-bold">(${verb.infinitive})</div>
                    </div>
                `;
                answerEl.innerText = `${verb.person} ${verb.number} ${verb.tense}`;
            }

            addToHistory(verb);
        }

        function addToHistory(verb) {
            const list = document.getElementById('history-list');
            const li = document.createElement('li');
            li.className = "bg-white p-3 rounded border border-slate-100 shadow-sm flex justify-between items-center text-sm hover:bg-indigo-50 transition";
            li.innerHTML = `
                <div>
                    <span class="font-bold text-slate-700 block">${verb.conjugation}</span>
                    <span class="text-xs text-slate-500">${verb.tense}</span>
                </div>
                <span class="text-xs text-indigo-300 font-mono">#${verb.id}</span>
            `;
            list.prepend(li);
        }

        // --- SISTEMA DE VERIFICACI√ìN AVANZADO ---
        function openVerifyModal() {
            const modal = document.getElementById('verify-modal');
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.querySelector('#verify-modal-content').classList.remove('scale-95', 'opacity-0');
                modal.querySelector('#verify-modal-content').classList.add('scale-100', 'opacity-100');
            }, 10);
            document.getElementById('verify-input').value = "";
            document.getElementById('verify-result').classList.add('hidden');
        }

        function closeVerifyModal() {
            const modal = document.getElementById('verify-modal');
            modal.querySelector('#verify-modal-content').classList.remove('scale-100', 'opacity-100');
            modal.querySelector('#verify-modal-content').classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 200);
        }

        function verifyCard() {
            const inputId = parseInt(document.getElementById('verify-input').value);
            const resultDiv = document.getElementById('verify-result');
            resultDiv.classList.remove('hidden');

            if (!inputId || isNaN(inputId)) {
                resultDiv.className = "bg-red-50 text-red-600 p-4 rounded-lg border border-red-200 mt-4";
                resultDiv.innerHTML = "Por favor, introduce un ID v√°lido.";
                return;
            }

            // 1. Reconstruir el cart√≥n usando la Semilla (Seed)
            const seededRandom = new SeededRandom(inputId);
            let deck = [...gameState.filtered];
            
            // Algoritmo Fisher-Yates con random seeded
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(seededRandom.next() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            const studentCards = deck.slice(0, 12);

            // 2. Comprobar contra las bolas sacadas
            let matches = 0;
            let missing = [];

            studentCards.forEach(verb => {
                if (gameState.drawnIds.has(verb.id)) {
                    matches++;
                } else {
                    missing.push(verb.conjugation);
                }
            });

            // 3. Mostrar Resultado
            if (matches === 12) {
                resultDiv.className = "bg-emerald-50 text-emerald-800 p-4 rounded-lg border border-emerald-200 mt-4 animate-bounce";
                resultDiv.innerHTML = `
                    <div class="text-4xl mb-2">üéâ</div>
                    <div class="font-bold text-xl">¬°BINGO CORRECTO!</div>
                    <div class="text-sm mt-1">El cart√≥n #${inputId} est√° completo.</div>
                `;
                startConfetti();
            } else {
                resultDiv.className = "bg-rose-50 text-rose-800 p-4 rounded-lg border border-rose-200 mt-4";
                resultDiv.innerHTML = `
                    <div class="text-4xl mb-2">‚ùå</div>
                    <div class="font-bold text-lg">BINGO INCORRECTO</div>
                    <div class="text-sm mt-2 font-bold">Faltan ${12 - matches} verbos:</div>
                    <div class="text-xs mt-1 text-rose-600 italic">${missing.slice(0,3).join(", ")}${missing.length > 3 ? '...' : ''}</div>
                `;
            }
        }

        // --- ALUMNO ---
        function generateStudentCard() {
            const grid = document.getElementById('bingo-grid');
            grid.innerHTML = "";
            
            // Generar ID random (que actuar√° como semilla)
            const cardId = Math.floor(Math.random() * 9000) + 1000;
            document.getElementById('card-id').innerText = cardId;

            // Replicamos la misma l√≥gica de "Shuffle" que usaremos en la verificaci√≥n
            const seededRandom = new SeededRandom(cardId);
            let deck = [...gameState.filtered];

            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(seededRandom.next() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            const items = deck.slice(0, 12);

            items.forEach(verb => {
                const cell = document.createElement('div');
                cell.className = "bingo-cell rounded flex items-center justify-center p-1 h-20 md:h-24 text-center select-none";

                let text = "";
                let subtext = "";
                
                if (gameState.mode === 'analyst') {
                    text = `<span class="font-bold text-slate-700 text-sm md:text-base leading-tight">${verb.conjugation}</span>`;
                } else {
                    text = `<span class="font-bold text-slate-700 text-xs md:text-sm leading-tight block">${verb.tense}</span>`;
                    subtext = `<span class="block text-[10px] text-slate-500 mt-1">${verb.person} ${verb.number}</span>`;
                }

                cell.innerHTML = `
                    <div class="bingo-chip"></div>
                    <div class="relative z-10 w-full">
                        ${text}
                        ${subtext}
                    </div>
                `;

                cell.onclick = () => cell.classList.toggle('marked');
                grid.appendChild(cell);
            });
        }

        // --- CONFETI ---
        function checkBingo() {
            startConfetti();
            const id = document.getElementById('card-id').innerText;
            setTimeout(() => alert(`¬°BINGO CANTADO!\n\nPor favor, dicta tu ID (${id}) al profesor para que lo verifique.`), 300);
        }

        // Simple Canvas Confetti
        const canvas = document.getElementById("confetti-canvas");
        const ctx = canvas.getContext("2d");
        let particles = [];
        window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;

        function startConfetti() {
            particles = [];
            for(let i=0; i<150; i++) {
                particles.push({
                    x: window.innerWidth/2, y: window.innerHeight/2,
                    vx: (Math.random()-0.5)*20, vy: (Math.random()-0.5)*20,
                    size: Math.random()*8+4, color: `hsl(${Math.random()*360},100%,50%)`, life: 100
                });
            }
            animateConfetti();
        }
        function animateConfetti() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            particles.forEach((p,i) => {
                p.x+=p.vx; p.y+=p.vy; p.vy+=0.5; p.life--;
                ctx.fillStyle=p.color; ctx.fillRect(p.x,p.y,p.size,p.size);
                if(p.life<=0) particles.splice(i,1);
            });
            if(particles.length) requestAnimationFrame(animateConfetti);
        }

    </script>
</body>
</html>
