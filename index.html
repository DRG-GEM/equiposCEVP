<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Verbal - CEVP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&family=Changa+One&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8fafc;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* --- ESTILOS CARTÓN --- */
        .bingo-card-container {
            background-color: #fff;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border: 1px solid #e2e8f0;
        }
        .bingo-header { font-family: 'Changa One', sans-serif; letter-spacing: 0.15em; }
        
        .bingo-cell {
            position: relative;
            background-color: #f1f5f9;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.1s;
        }
        .bingo-cell:active { transform: scale(0.96); }

        /* Ficha semitransparente */
        .bingo-chip {
            position: absolute;
            top: 50%; left: 50%;
            width: 80%; height: 80%;
            background-color: rgba(239, 68, 68, 0.5);
            border-radius: 50%;
            border: 4px solid rgba(220, 38, 38, 0.8);
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .bingo-cell.marked .bingo-chip { transform: translate(-50%, -50%) scale(1); }

        /* --- TARJETITAS (TAGS) --- */
        .tag-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 700;
            font-size: 1.1rem;
            margin: 0.25rem;
            box-shadow: 0 2px 0 rgba(0,0,0,0.05);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        /* Colores específicos para cada categoría gramatical */
        .tag-person { background-color: #e0e7ff; color: #3730a3; border: 1px solid #c7d2fe; } /* Indigo */
        .tag-number { background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; } /* Green */
        .tag-tense  { background-color: #ffedd5; color: #9a3412; border: 1px solid #fed7aa; } /* Orange */
        .tag-mood   { background-color: #f3f4f6; color: #374151; border: 1px solid #e5e7eb; } /* Gray */

        .screen-enter { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .animate-pop { animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { 0% { opacity:0; transform: scale(0.5); } 100% { opacity:1; transform: scale(1); } }
    </style>
</head>
<body class="min-h-screen text-slate-800 flex flex-col">

    <!-- HEADER -->
    <header class="bg-slate-900 text-white p-3 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="location.reload()">
                <!-- LOGO COOPERATIVA -->
                <div class="bg-white p-1 rounded-lg h-12 w-12 flex items-center justify-center overflow-hidden">
                    <img src="https://web.virgendelpasico.net/wp-content/uploads/2024/01/cropped-ncoop-scaled-1-300x253.jpg" alt="Logo Cooperativa" class="h-full w-auto object-contain">
                </div>
                <div>
                    <h1 class="text-xl font-bold leading-none tracking-tight">Bingo Verbal</h1>
                    <!-- TEXTO MODIFICADO -->
                    <span class="text-xs text-slate-400 font-bold tracking-wide">CEVP</span>
                </div>
            </div>
            <button onclick="location.reload()" class="bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-lg text-sm transition border border-slate-700 flex items-center gap-2">
                <i class="ph ph-arrow-counter-clockwise"></i> <span class="hidden md:inline">Reiniciar</span>
            </button>
        </div>
    </header>

    <main class="flex-grow container mx-auto p-4 max-w-6xl">

        <!-- CONFIGURACIÓN -->
        <section id="config-screen" class="screen-enter max-w-2xl mx-auto mt-8">
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200">
                <div class="bg-indigo-600 p-6 text-white text-center">
                    <h2 class="text-3xl font-bold mb-1">Bingo de Tiempos Verbales</h2>
                    <p class="text-indigo-200 text-sm">Configuración de la partida</p>
                </div>

                <div class="p-8">
                    <!-- Modo de Juego -->
                    <div class="mb-8">
                        <label class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-3 block">1. Dinámica de Juego</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- MODO DETECTIVE -->
                            <label class="relative group cursor-pointer">
                                <input type="radio" name="gameMode" value="analyst" class="peer sr-only" checked>
                                <div class="p-4 rounded-xl border-2 border-slate-200 peer-checked:border-indigo-500 peer-checked:bg-indigo-50 transition hover:border-indigo-200 h-full">
                                    <div class="flex items-center gap-3 mb-2">
                                        <div class="bg-indigo-100 text-indigo-600 p-2 rounded-full"><i class="ph ph-magnifying-glass text-xl"></i></div>
                                        <span class="font-bold text-slate-800">Detective de Verbos</span>
                                    </div>
                                    <p class="text-xs text-slate-600 leading-relaxed">
                                        Tú das las <span class="font-bold text-indigo-600">pistas</span> (persona, tiempo...).<br>
                                        Ellos encuentran al sospechoso ("Yo comí").
                                    </p>
                                </div>
                            </label>
                            <!-- MODO MAESTRO -->
                            <label class="relative group cursor-pointer">
                                <input type="radio" name="gameMode" value="identifier" class="peer sr-only">
                                <div class="p-4 rounded-xl border-2 border-slate-200 peer-checked:border-indigo-500 peer-checked:bg-indigo-50 transition hover:border-indigo-200 h-full">
                                    <div class="flex items-center gap-3 mb-2">
                                        <div class="bg-indigo-100 text-indigo-600 p-2 rounded-full"><i class="ph ph-graduation-cap text-xl"></i></div>
                                        <span class="font-bold text-slate-800">Maestro Gramatical</span>
                                    </div>
                                    <p class="text-xs text-slate-600 leading-relaxed">
                                        Tú muestras el <span class="font-bold text-indigo-600">verbo conjugado</span>.<br>
                                        Ellos demuestran saber qué tiempo es.
                                    </p>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- SELECTOR DE DIFICULTAD (REEMPLAZA FILTROS) -->
                    <div class="mb-8">
                        <label class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-3 block">2. Nivel de Dificultad</label>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                            
                            <!-- NIVEL 1 -->
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="difficulty" value="1" class="peer sr-only" checked>
                                <div class="p-3 rounded-xl border-2 border-slate-200 bg-white peer-checked:border-emerald-500 peer-checked:bg-emerald-50 hover:bg-slate-50 transition h-full flex flex-col">
                                    <div class="font-bold text-slate-700 peer-checked:text-emerald-700 mb-1 flex items-center gap-2">
                                        <span class="w-3 h-3 rounded-full bg-emerald-500"></span> Nivel 1
                                    </div>
                                    <div class="text-xs text-slate-500 mt-1 flex-grow">
                                        <p class="font-semibold mb-1 text-slate-600">Iniciado</p>
                                        <ul class="list-disc list-inside opacity-80">
                                            <li>Solo Indicativo</li>
                                            <li>Solo Tiempos Simples</li>
                                        </ul>
                                    </div>
                                </div>
                            </label>

                            <!-- NIVEL 2 -->
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="difficulty" value="2" class="peer sr-only">
                                <div class="p-3 rounded-xl border-2 border-slate-200 bg-white peer-checked:border-amber-500 peer-checked:bg-amber-50 hover:bg-slate-50 transition h-full flex flex-col">
                                    <div class="font-bold text-slate-700 peer-checked:text-amber-700 mb-1 flex items-center gap-2">
                                        <span class="w-3 h-3 rounded-full bg-amber-500"></span> Nivel 2
                                    </div>
                                    <div class="text-xs text-slate-500 mt-1 flex-grow">
                                        <p class="font-semibold mb-1 text-slate-600">Experto</p>
                                        <ul class="list-disc list-inside opacity-80">
                                            <li>Todo el Indicativo</li>
                                            <li>Simples y Compuestos</li>
                                        </ul>
                                    </div>
                                </div>
                            </label>

                            <!-- NIVEL 3 -->
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="difficulty" value="3" class="peer sr-only">
                                <div class="p-3 rounded-xl border-2 border-slate-200 bg-white peer-checked:border-rose-500 peer-checked:bg-rose-50 hover:bg-slate-50 transition h-full flex flex-col">
                                    <div class="font-bold text-slate-700 peer-checked:text-rose-700 mb-1 flex items-center gap-2">
                                        <span class="w-3 h-3 rounded-full bg-rose-500"></span> Nivel 3
                                    </div>
                                    <div class="text-xs text-slate-500 mt-1 flex-grow">
                                        <p class="font-semibold mb-1 text-slate-600">Maestro</p>
                                        <ul class="list-disc list-inside opacity-80">
                                            <li>Indicativo Completo</li>
                                            <li>Subjuntivo Completo</li>
                                        </ul>
                                    </div>
                                </div>
                            </label>

                        </div>
                        <p id="error-msg" class="text-rose-500 text-sm mt-3 hidden font-bold flex items-center gap-2">
                            <i class="ph ph-warning-circle text-lg"></i> Error de carga.
                        </p>
                    </div>

                    <!-- Botones de Acción -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-slate-100">
                        <button onclick="startGame('teacher')" class="flex items-center justify-center gap-3 p-4 bg-slate-900 text-white rounded-xl shadow hover:bg-slate-800 transition transform active:scale-95">
                            <i class="ph ph-projector-screen-chart text-2xl"></i>
                            <div class="text-left leading-tight">
                                <span class="block font-bold">Soy el Profesor</span>
                                <span class="text-xs text-slate-400">Pantalla de proyección</span>
                            </div>
                        </button>
                        <button onclick="startGame('student')" class="flex items-center justify-center gap-3 p-4 bg-white border-2 border-slate-200 text-slate-700 rounded-xl hover:border-indigo-500 hover:text-indigo-600 transition transform active:scale-95">
                            <i class="ph ph-student text-2xl"></i>
                            <div class="text-left leading-tight">
                                <span class="block font-bold">Soy Alumno</span>
                                <span class="text-xs text-slate-400">Generar mi cartón</span>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- PANTALLA PROFESOR -->
        <section id="teacher-screen" class="hidden screen-enter h-full flex flex-col">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 h-full">
                
                <!-- ZONA PRINCIPAL (PROYECCIÓN) -->
                <div class="lg:col-span-8 flex flex-col gap-4">
                    <!-- Caja de la Bola -->
                    <div class="bg-white rounded-2xl shadow-xl border border-slate-200 flex flex-col relative overflow-hidden min-h-[400px]">
                        <!-- Barra superior -->
                        <div class="bg-indigo-600 h-3 w-full"></div>
                        <div class="absolute top-5 right-5">
                            <span class="bg-slate-100 text-slate-500 px-3 py-1 rounded-full text-sm font-bold border border-slate-200">
                                Restantes: <span id="remaining-count" class="text-indigo-600">--</span>
                            </span>
                        </div>

                        <!-- CONTENIDO CENTRAL (BOLA) -->
                        <div id="ball-display" class="flex-grow flex flex-col items-center justify-center p-8 text-center">
                            <div class="text-slate-400 flex flex-col items-center animate-pulse">
                                <i class="ph ph-play-circle text-6xl mb-4"></i>
                                <span class="text-xl font-medium">Pulsa "Sacar Bola" para comenzar</span>
                            </div>
                        </div>

                        <!-- ZONA INFERIOR (CONTROLES) -->
                        <div class="bg-slate-50 p-6 border-t border-slate-200 flex items-center justify-between gap-4">
                             <!-- Spoiler Toggle -->
                            <div class="flex items-center gap-2">
                                <button onclick="toggleAnswer()" class="text-slate-400 hover:text-indigo-600 p-2 rounded-lg hover:bg-white transition" title="Ver respuesta">
                                    <i id="eye-icon" class="ph ph-eye-slash text-2xl"></i>
                                </button>
                                <div id="spoiler-answer" class="text-lg font-bold text-slate-800 opacity-0 transition-opacity select-none bg-white px-4 py-1 rounded shadow-sm border border-slate-200">
                                    <!-- Aquí va la respuesta oculta -->
                                    ...
                                </div>
                            </div>

                            <button onclick="drawBall()" class="bg-indigo-600 hover:bg-indigo-700 text-white text-xl font-bold py-3 px-8 rounded-xl shadow-lg shadow-indigo-200 transform active:translate-y-1 transition flex items-center gap-3">
                                <i class="ph ph-shuffle"></i>
                                <span>SACAR BOLA</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ZONA LATERAL (HISTORIAL) -->
                <div class="lg:col-span-4 bg-white rounded-2xl shadow-lg border border-slate-200 flex flex-col overflow-hidden max-h-[600px]">
                    <div class="bg-slate-100 p-4 font-bold text-slate-700 flex items-center justify-between border-b border-slate-200">
                        <span class="flex items-center gap-2"><i class="ph ph-clock-counter-clockwise"></i> Últimos Verbos</span>
                        <span class="text-xs bg-white px-2 py-1 rounded border border-slate-200 text-slate-400 font-mono">LOG</span>
                    </div>
                    <ul id="history-list" class="flex-1 overflow-y-auto p-2 space-y-2 bg-slate-50">
                        <!-- Items -->
                    </ul>
                </div>
            </div>
        </section>

        <!-- PANTALLA ALUMNO -->
        <section id="student-screen" class="hidden screen-enter max-w-lg mx-auto pb-12">
            
            <div class="flex items-center justify-between mb-6 px-2">
                <div>
                    <h2 class="font-bold text-slate-800 text-lg">Tu Cartón</h2>
                    <p class="text-xs text-slate-500">Escucha al profesor y marca.</p>
                </div>
                <button onclick="checkBingo()" class="bg-emerald-500 hover:bg-emerald-600 text-white px-5 py-2 rounded-full font-bold shadow-lg shadow-emerald-200 transform hover:-translate-y-1 transition flex items-center gap-2">
                    <i class="ph ph-hand-waving"></i> ¡BINGO!
                </button>
            </div>

            <!-- CARTÓN -->
            <div class="bingo-card-container rounded-xl overflow-hidden transform transition-transform hover:scale-[1.01] duration-300">
                <div class="bg-indigo-600 p-4 text-center border-b-4 border-indigo-800 relative">
                    <div class="absolute top-1/2 left-4 -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow-inner opacity-50"></div>
                    <div class="absolute top-1/2 right-4 -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow-inner opacity-50"></div>
                    <h1 class="bingo-header text-5xl text-white drop-shadow-md">BINGO</h1>
                </div>

                <div id="bingo-grid" class="grid grid-cols-4 gap-1 p-2 bg-slate-200">
                    <!-- JS generará las celdas aquí -->
                </div>
                
                <div class="bg-slate-100 p-2 flex justify-between items-center text-[10px] text-slate-400 font-mono uppercase border-t border-slate-200">
                    <span>ID: <span id="card-id">--</span></span>
                    <span onclick="generateStudentCard()" class="cursor-pointer hover:text-indigo-500 underline decoration-dotted">Cambiar Cartón</span>
                </div>
            </div>

        </section>

    </main>

    <!-- CONFETI -->
    <canvas id="confetti-canvas" class="fixed top-0 left-0 w-full h-full pointer-events-none z-50"></canvas>

    <!-- LOGICA -->
    <script>
        // ============================================
        // 1. GENERACIÓN DE DATOS ESTRUCTURADOS (TAGS)
        // ============================================
        
        // Estructura Raw para fácil edición: [Verbo, Conjugación, Persona, Número, Tiempo, Modo, Tipo]
        const rawData = [
            // --- INDICATIVO SIMPLE (30+) ---
            ["Comer", "Yo como", "1ª", "Singular", "Presente", "Indicativo", "simple"],
            ["Vivir", "Tú vives", "2ª", "Singular", "Presente", "Indicativo", "simple"],
            ["Cantar", "Él canta", "3ª", "Singular", "Presente", "Indicativo", "simple"],
            ["Beber", "Nosotros bebemos", "1ª", "Plural", "Presente", "Indicativo", "simple"],
            ["Escribir", "Vosotros escribís", "2ª", "Plural", "Presente", "Indicativo", "simple"],
            ["Correr", "Ellos corren", "3ª", "Plural", "Presente", "Indicativo", "simple"],
            
            ["Saltar", "Yo salté", "1ª", "Singular", "Pret. Perf. Simple", "Indicativo", "simple"],
            ["Comer", "Tú comiste", "2ª", "Singular", "Pret. Perf. Simple", "Indicativo", "simple"],
            ["Salir", "Él salió", "3ª", "Singular", "Pret. Perf. Simple", "Indicativo", "simple"],
            ["Ver", "Nosotros vimos", "1ª", "Plural", "Pret. Perf. Simple", "Indicativo", "simple"],
            ["Dar", "Vosotros disteis", "2ª", "Plural", "Pret. Perf. Simple", "Indicativo", "simple"],
            ["Ir", "Ellos fueron", "3ª", "Plural", "Pret. Perf. Simple", "Indicativo", "simple"],

            ["Estar", "Yo estaba", "1ª", "Singular", "Pret. Imperfecto", "Indicativo", "simple"],
            ["Tener", "Tú tenías", "2ª", "Singular", "Pret. Imperfecto", "Indicativo", "simple"],
            ["Hacer", "Ella hacía", "3ª", "Singular", "Pret. Imperfecto", "Indicativo", "simple"],
            ["Jugar", "Nosotros jugábamos", "1ª", "Plural", "Pret. Imperfecto", "Indicativo", "simple"],
            ["Leer", "Vosotros leíais", "2ª", "Plural", "Pret. Imperfecto", "Indicativo", "simple"],
            ["Decir", "Ellos decían", "3ª", "Plural", "Pret. Imperfecto", "Indicativo", "simple"],

            ["Amar", "Yo amaré", "1ª", "Singular", "Futuro Simple", "Indicativo", "simple"],
            ["Saber", "Tú sabrás", "2ª", "Singular", "Futuro Simple", "Indicativo", "simple"],
            ["Poner", "Él pondrá", "3ª", "Singular", "Futuro Simple", "Indicativo", "simple"],
            ["Venir", "Nosotros vendremos", "1ª", "Plural", "Futuro Simple", "Indicativo", "simple"],
            ["Tener", "Vosotros tendréis", "2ª", "Plural", "Futuro Simple", "Indicativo", "simple"],
            ["Hacer", "Ellos harán", "3ª", "Plural", "Futuro Simple", "Indicativo", "simple"],

            ["Ser", "Yo sería", "1ª", "Singular", "Condicional Simple", "Indicativo", "simple"],
            ["Ir", "Tú irías", "2ª", "Singular", "Condicional Simple", "Indicativo", "simple"],
            ["Ver", "Él vería", "3ª", "Singular", "Condicional Simple", "Indicativo", "simple"],
            ["Dar", "Nosotros daríamos", "1ª", "Plural", "Condicional Simple", "Indicativo", "simple"],
            ["Saber", "Vosotros sabríais", "2ª", "Plural", "Condicional Simple", "Indicativo", "simple"],
            ["Poder", "Ellos podrían", "3ª", "Plural", "Condicional Simple", "Indicativo", "simple"],

            // --- INDICATIVO COMPUESTO (20+) ---
            ["Hablar", "Yo he hablado", "1ª", "Singular", "Pret. Perf. Compuesto", "Indicativo", "compound"],
            ["Estudiar", "Tú has estudiado", "2ª", "Singular", "Pret. Perf. Compuesto", "Indicativo", "compound"],
            ["Abrir", "Él ha abierto", "3ª", "Singular", "Pret. Perf. Compuesto", "Indicativo", "compound"],
            ["Romper", "Nosotros hemos roto", "1ª", "Plural", "Pret. Perf. Compuesto", "Indicativo", "compound"],
            ["Ver", "Ellos han visto", "3ª", "Plural", "Pret. Perf. Compuesto", "Indicativo", "compound"],
            
            ["Vivir", "Yo había vivido", "1ª", "Singular", "Pret. Pluscuamperf.", "Indicativo", "compound"],
            ["Llegar", "Tú habías llegado", "2ª", "Singular", "Pret. Pluscuamperf.", "Indicativo", "compound"],
            ["Salir", "Él había salido", "3ª", "Singular", "Pret. Pluscuamperf.", "Indicativo", "compound"],
            ["Acabar", "Nosotros habíamos acabado", "1ª", "Plural", "Pret. Pluscuamperf.", "Indicativo", "compound"],
            ["Caer", "Ellos habían caído", "3ª", "Plural", "Pret. Pluscuamperf.", "Indicativo", "compound"],
            
            ["Ganar", "Yo habré ganado", "1ª", "Singular", "Futuro Compuesto", "Indicativo", "compound"],
            ["Perder", "Tú habrás perdido", "2ª", "Singular", "Futuro Compuesto", "Indicativo", "compound"],
            ["Elegir", "Él habrá elegido", "3ª", "Singular", "Futuro Compuesto", "Indicativo", "compound"],
            ["Andar", "Nosotros habremos andado", "1ª", "Plural", "Futuro Compuesto", "Indicativo", "compound"],
            ["Dormir", "Ellos habrán dormido", "3ª", "Plural", "Futuro Compuesto", "Indicativo", "compound"],
            
            ["Estar", "Yo habría estado", "1ª", "Singular", "Condic. Compuesto", "Indicativo", "compound"],
            ["Ser", "Tú habrías sido", "2ª", "Singular", "Condic. Compuesto", "Indicativo", "compound"],
            ["Ir", "Él habría ido", "3ª", "Singular", "Condic. Compuesto", "Indicativo", "compound"],
            ["Tener", "Nosotros habríamos tenido", "1ª", "Plural", "Condic. Compuesto", "Indicativo", "compound"],
            ["Hacer", "Ellos habrían hecho", "3ª", "Plural", "Condic. Compuesto", "Indicativo", "compound"],

            // --- SUBJUNTIVO SIMPLE (18+) ---
            ["Cantar", "Yo cante", "1ª", "Singular", "Presente", "Subjuntivo", "simple"],
            ["Beber", "Tú bebas", "2ª", "Singular", "Presente", "Subjuntivo", "simple"],
            ["Vivir", "Él viva", "3ª", "Singular", "Presente", "Subjuntivo", "simple"],
            ["Tener", "Nosotros tengamos", "1ª", "Plural", "Presente", "Subjuntivo", "simple"],
            ["Salir", "Vosotros salgáis", "2ª", "Plural", "Presente", "Subjuntivo", "simple"],
            ["Poner", "Ellos pongan", "3ª", "Plural", "Presente", "Subjuntivo", "simple"],

            ["Hablar", "Yo hablara", "1ª", "Singular", "Pret. Imperfecto", "Subjuntivo", "simple"],
            ["Comer", "Tú comieras", "2ª", "Singular", "Pret. Imperfecto", "Subjuntivo", "simple"],
            ["Saber", "Él supiera", "3ª", "Singular", "Pret. Imperfecto", "Subjuntivo", "simple"],
            ["Ir", "Nosotros fuéramos", "1ª", "Plural", "Pret. Imperfecto", "Subjuntivo", "simple"],
            ["Hacer", "Vosotros hicierais", "2ª", "Plural", "Pret. Imperfecto", "Subjuntivo", "simple"],
            ["Decir", "Ellos dijeran", "3ª", "Plural", "Pret. Imperfecto", "Subjuntivo", "simple"],

            ["Estar", "Yo estuviese", "1ª", "Singular", "Pret. Imperfecto (B)", "Subjuntivo", "simple"],
            ["Ser", "Tú fueses", "2ª", "Singular", "Pret. Imperfecto (B)", "Subjuntivo", "simple"],
            ["Dar", "Él diese", "3ª", "Singular", "Pret. Imperfecto (B)", "Subjuntivo", "simple"],
            ["Ver", "Nosotros viésemos", "1ª", "Plural", "Pret. Imperfecto (B)", "Subjuntivo", "simple"],
            ["Oír", "Vosotros oyeseis", "2ª", "Plural", "Pret. Imperfecto (B)", "Subjuntivo", "simple"],
            ["Traer", "Ellos trajesen", "3ª", "Plural", "Pret. Imperfecto (B)", "Subjuntivo", "simple"],

            // --- SUBJUNTIVO COMPUESTO (10+) ---
            ["Acabar", "Yo haya acabado", "1ª", "Singular", "Pret. Perf. Compuesto", "Subjuntivo", "compound"],
            ["Empezar", "Tú hayas empezado", "2ª", "Singular", "Pret. Perf. Compuesto", "Subjuntivo", "compound"],
            ["Volver", "Él haya vuelto", "3ª", "Singular", "Pret. Perf. Compuesto", "Subjuntivo", "compound"],
            ["Ver", "Nosotros hayamos visto", "1ª", "Plural", "Pret. Perf. Compuesto", "Subjuntivo", "compound"],
            ["Abrir", "Ellos hayan abierto", "3ª", "Plural", "Pret. Perf. Compuesto", "Subjuntivo", "compound"],

            ["Llamar", "Yo hubiera llamado", "1ª", "Singular", "Pret. Pluscuamperf.", "Subjuntivo", "compound"],
            ["Sentir", "Tú hubieras sentido", "2ª", "Singular", "Pret. Pluscuamperf.", "Subjuntivo", "compound"],
            ["Pedir", "Él hubiera pedido", "3ª", "Singular", "Pret. Pluscuamperf.", "Subjuntivo", "compound"],
            ["Dormir", "Nosotros hubiéramos dormido", "1ª", "Plural", "Pret. Pluscuamperf.", "Subjuntivo", "compound"],
            ["Morir", "Ellos hubieran muerto", "3ª", "Plural", "Pret. Pluscuamperf.", "Subjuntivo", "compound"]
        ];

        // Mapear a Objetos
        const verbDatabase = rawData.map((d, i) => ({
            id: i + 1,
            infinitive: d[0],
            conjugation: d[1],
            person: d[2],
            number: d[3],
            tense: d[4],
            mood: d[5],
            type: d[6],
            // Texto completo para el modo "identificador" del alumno
            fullDesc: `${d[2]} ${d[3]} ${d[4]} (${d[5]})`
        }));

        // ============================================
        // 2. ESTADO
        // ============================================
        let gameState = {
            role: null,
            mode: 'analyst',
            filtered: [],
            available: [],
            currentVerb: null
        };

        // ============================================
        // 3. FUNCIONES DE JUEGO
        // ============================================

        function startGame(role) {
            // Leer Nivel de Dificultad
            const diffLevel = document.querySelector('input[name="difficulty"]:checked').value;
            let filtered = [];

            // Lógica de filtrado según nivel
            filtered = verbDatabase.filter(v => {
                if (diffLevel === "1") {
                    // Nivel 1: Solo Indicativo Simple
                    return v.mood === 'Indicativo' && v.type === 'simple';
                } else if (diffLevel === "2") {
                    // Nivel 2: Todo el Indicativo
                    return v.mood === 'Indicativo';
                } else {
                    // Nivel 3: Todo (Indicativo + Subjuntivo)
                    return true; 
                }
            });

            if (filtered.length < 12) {
                document.getElementById('error-msg').innerText = "Error: No hay suficientes verbos para este nivel.";
                document.getElementById('error-msg').classList.remove('hidden');
                return;
            }

            // Guardar Estado
            gameState.filtered = filtered;
            gameState.available = [...filtered];
            gameState.role = role;
            gameState.mode = document.querySelector('input[name="gameMode"]:checked').value;

            // Cambiar UI
            document.getElementById('config-screen').classList.add('hidden');
            
            if (role === 'teacher') {
                document.getElementById('teacher-screen').classList.remove('hidden');
                updateRemaining();
            } else {
                document.getElementById('student-screen').classList.remove('hidden');
                generateStudentCard();
            }
        }

        // --- PROFESOR ---
        function updateRemaining() {
            document.getElementById('remaining-count').innerText = gameState.available.length;
        }

        function toggleAnswer() {
            const el = document.getElementById('spoiler-answer');
            const icon = document.getElementById('eye-icon');
            if (el.classList.contains('opacity-0')) {
                el.classList.remove('opacity-0');
                icon.className = "ph ph-eye text-2xl text-indigo-600";
            } else {
                el.classList.add('opacity-0');
                icon.className = "ph ph-eye-slash text-2xl";
            }
        }

        function drawBall() {
            if (gameState.available.length === 0) {
                alert("¡Fin de las bolas!");
                return;
            }

            // Reset Spoiler
            document.getElementById('spoiler-answer').classList.add('opacity-0');
            document.getElementById('eye-icon').className = "ph ph-eye-slash text-2xl";

            // Sacar Bola
            const idx = Math.floor(Math.random() * gameState.available.length);
            const verb = gameState.available[idx];
            gameState.available.splice(idx, 1);
            gameState.currentVerb = verb;
            updateRemaining();

            // Renderizar Bola según MODO
            const display = document.getElementById('ball-display');
            const answerEl = document.getElementById('spoiler-answer');

            display.innerHTML = ''; // Limpiar

            if (gameState.mode === 'analyst') {
                // MODO ANALISTA: Muestro TAGS, Oculto Conjugación
                // Formato Tarjetitas
                display.innerHTML = `
                    <div class="animate-pop flex flex-col items-center gap-4">
                        <div class="text-xs text-slate-400 font-mono uppercase tracking-widest mb-2">Descripción Gramatical</div>
                        
                        <div class="flex flex-wrap justify-center gap-2 max-w-2xl">
                            <span class="tag-badge tag-person">${verb.person} Persona</span>
                            <span class="tag-badge tag-number">${verb.number}</span>
                        </div>
                        
                        <div class="flex flex-wrap justify-center gap-2 max-w-3xl my-2">
                            <span class="tag-badge tag-tense text-2xl md:text-4xl py-3 px-6 shadow-md border-b-4 border-orange-200">${verb.tense}</span>
                        </div>

                        <div class="flex flex-wrap justify-center gap-2">
                            <span class="tag-badge tag-mood">${verb.mood}</span>
                        </div>
                    </div>
                `;
                answerEl.innerText = verb.conjugation; // "Yo como"

            } else {
                // MODO IDENTIFICADOR: Muestro Conjugación, Oculto Tags
                display.innerHTML = `
                    <div class="animate-pop flex flex-col items-center">
                        <div class="text-xs text-slate-400 font-mono uppercase tracking-widest mb-4">Verbo Conjugado</div>
                        <h2 class="text-5xl md:text-7xl font-bold text-indigo-700 drop-shadow-sm mb-4">${verb.conjugation}</h2>
                        <div class="bg-indigo-50 text-indigo-400 px-4 py-1 rounded-full text-sm font-bold">(${verb.infinitive})</div>
                    </div>
                `;
                // Descripción abreviada para respuesta
                answerEl.innerText = `${verb.person} ${verb.number} ${verb.tense}`;
            }

            // Historial
            addToHistory(verb);
        }

        function addToHistory(verb) {
            const list = document.getElementById('history-list');
            const li = document.createElement('li');
            li.className = "bg-white p-3 rounded border border-slate-100 shadow-sm flex justify-between items-center text-sm hover:bg-indigo-50 transition";
            
            // Texto del historial depende del modo inverso? No, historial muestra AMBOS en pequeño para referencia del profe
            li.innerHTML = `
                <div>
                    <span class="font-bold text-slate-700 block">${verb.conjugation}</span>
                    <span class="text-xs text-slate-500">${verb.tense}</span>
                </div>
                <span class="text-xs text-indigo-300 font-mono">#${verb.id}</span>
            `;
            list.prepend(li);
        }

        // --- ALUMNO ---
        function generateStudentCard() {
            const grid = document.getElementById('bingo-grid');
            grid.innerHTML = "";
            document.getElementById('card-id').innerText = Math.floor(Math.random()*9000)+1000;

            // 12 items random
            const shuffled = [...gameState.filtered].sort(() => 0.5 - Math.random());
            const items = shuffled.slice(0, 12);

            items.forEach(verb => {
                const cell = document.createElement('div');
                cell.className = "bingo-cell rounded flex items-center justify-center p-1 h-20 md:h-24 text-center select-none";

                // TEXTO DEL ALUMNO (Inverso al del profe)
                let text = "";
                let subtext = "";
                
                if (gameState.mode === 'analyst') {
                    // Profe muestra Descripción -> Alumno ve Conjugación
                    text = `<span class="font-bold text-slate-700 text-sm md:text-base leading-tight">${verb.conjugation}</span>`;
                } else {
                    // Profe muestra Conjugación -> Alumno ve Descripción
                    // Simplificamos visualmente para que quepa
                    text = `<span class="font-bold text-slate-700 text-xs md:text-sm leading-tight block">${verb.tense}</span>`;
                    subtext = `<span class="block text-[10px] text-slate-500 mt-1">${verb.person} ${verb.number}</span>`;
                }

                cell.innerHTML = `
                    <div class="bingo-chip"></div>
                    <div class="relative z-10 w-full">
                        ${text}
                        ${subtext}
                    </div>
                `;

                cell.onclick = () => cell.classList.toggle('marked');
                grid.appendChild(cell);
            });
        }

        // --- CONFETI ---
        function checkBingo() {
            startConfetti();
            setTimeout(() => alert("¡BINGO! Comprobemos..."), 500);
        }

        // Simple Canvas Confetti
        const canvas = document.getElementById("confetti-canvas");
        const ctx = canvas.getContext("2d");
        let particles = [];
        window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;

        function startConfetti() {
            particles = [];
            for(let i=0; i<150; i++) {
                particles.push({
                    x: window.innerWidth/2, y: window.innerHeight/2,
                    vx: (Math.random()-0.5)*20, vy: (Math.random()-0.5)*20,
                    size: Math.random()*8+4, color: `hsl(${Math.random()*360},100%,50%)`, life: 100
                });
            }
            animateConfetti();
        }
        function animateConfetti() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            particles.forEach((p,i) => {
                p.x+=p.vx; p.y+=p.vy; p.vy+=0.5; p.life--;
                ctx.fillStyle=p.color; ctx.fillRect(p.x,p.y,p.size,p.size);
                if(p.life<=0) particles.splice(i,1);
            });
            if(particles.length) requestAnimationFrame(animateConfetti);
        }

    </script>
</body>
</html>
